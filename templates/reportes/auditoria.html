{% extends 'base.html' %}

{% block content %}
<div class="container my-5">

  <!-- Card principal -->
  <div class="card shadow-sm border-0 rounded-3">
    <div class="card-body p-4">

      <!-- Header -->
      <div class="mb-4">
        <h2 class="h3 fw-bold mb-1">ðŸ“‹ Reporte de AuditorÃ­a de Usuarios</h2>
        <p class="text-muted mb-0">Filtra y consulta los movimientos realizados por los usuarios</p>
      </div>

      <!-- Formulario de filtros -->
      <form method="get" class="row g-3 mb-4">
        <div class="col-md-4">
          <label for="usuario" class="form-label fw-semibold">Usuario</label>
          <select name="usuario" id="usuario" class="form-select">
            <option value="">Todos los usuarios</option>
            {% for user in usuarios %}
            <option value="{{ user.id }}" {% if request.GET.usuario == user.id|stringformat:"s" %}selected{% endif %}>
              {{ user.username }}
            </option>
            {% endfor %}
          </select>
        </div>
        <div class="col-md-3">
          <label for="fecha_desde" class="form-label fw-semibold">Desde</label>
          <input type="date" name="fecha_desde" id="fecha_desde" class="form-control" value="{{ request.GET.fecha_desde }}">
        </div>
        <div class="col-md-3">
          <label for="fecha_hasta" class="form-label fw-semibold">Hasta</label>
          <input type="date" name="fecha_hasta" id="fecha_hasta" class="form-control" value="{{ request.GET.fecha_hasta }}">
        </div>
        <div class="col-md-2 d-flex align-items-end">
          <button type="submit" class="btn btn-primary w-100">
            <i class="bi bi-funnel me-1"></i> Filtrar
          </button>
        </div>
      </form>

      <!-- Tabla de resultados -->
      <div class="table-responsive shadow-sm rounded">
        <table class="table table-striped table-hover align-middle mb-0">
          <thead class="table-dark">
            <tr>
              <th>Fecha y Hora</th>
              <th>Usuario</th>
              <th>AcciÃ³n</th>
              <th>Tabla Afectada</th>
              <th>Datos Nuevos</th>
            </tr>
          </thead>
          <tbody>
            {% for mov in movimientos %}
            <tr>
              <td>{{ mov.fecha_hora|date:"d/m/Y H:i:s" }}</td>
              <td>{{ mov.usuario.username }}</td>
              <td>{{ mov.get_accion_display }}</td>
              <td>{{ mov.tabla }}</td>
              <td><small class="text-muted">{{ mov.datos_nuevos }}</small></td>
            </tr>
            {% empty %}
            <tr>
              <td colspan="5" class="text-center text-muted py-4">
                <i class="bi bi-inbox me-1"></i> No hay registros para mostrar
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

    </div>
  </div>
</div>
{% endblock %}
