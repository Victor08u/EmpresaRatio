{% extends "base.html" %}
{% load widget_tweaks %}

{% block content %}
<div class="container my-5">

  <!-- Card principal -->
  <div class="card shadow-sm border-0 rounded-3">
    <div class="card-body">

      <!-- Header -->
      <div class="mb-4">
        <h2 class="h3 fw-bold mb-1">ðŸ’µ Nuevo Movimiento de Caja</h2>
        <p class="text-muted mb-0">Completa los datos para registrar un movimiento en la caja</p>
      </div>

      <!-- Formulario -->
      <form method="post" class="row g-3">
        {% csrf_token %}

        <!-- Tipo -->
        <div class="col-md-4">
          <label for="{{ form.tipo.id_for_label }}" class="form-label fw-semibold">Tipo</label>
          {{ form.tipo|add_class:"form-select" }}
          {% for error in form.tipo.errors %}
            <div class="text-danger small">{{ error }}</div>
          {% endfor %}
        </div>

        <!-- Modalidad -->
        <div class="col-md-4">
          <label for="{{ form.modalidad.id_for_label }}" class="form-label fw-semibold">Modalidad</label>
          {{ form.modalidad|add_class:"form-select" }}
          {% for error in form.modalidad.errors %}
            <div class="text-danger small">{{ error }}</div>
          {% endfor %}
        </div>

        <!-- Forma de Pago -->
        <div class="col-md-4">
          <label for="{{ form.tipo_pago.id_for_label }}" class="form-label fw-semibold">Forma de Pago</label>
          {{ form.tipo_pago|add_class:"form-select" }}
          {% for error in form.tipo_pago.errors %}
            <div class="text-danger small">{{ error }}</div>
          {% endfor %}
        </div>

        <!-- Monto -->
        <div class="col-md-6">
          <label for="{{ form.monto.id_for_label }}" class="form-label fw-semibold">Monto</label>
          {{ form.monto|add_class:"form-control" }}
          {% for error in form.monto.errors %}
            <div class="text-danger small">{{ error }}</div>
          {% endfor %}
        </div>

        <!-- NÃºmero de Referencia -->
        <div class="col-md-6" id="div_numero_referencia">
          <label for="{{ form.numero_referencia.id_for_label }}" class="form-label fw-semibold">NÃºmero de Referencia</label>
          {{ form.numero_referencia|add_class:"form-control" }}
          <small class="text-muted">Solo necesario para tarjeta o transferencia</small>
          {% for error in form.numero_referencia.errors %}
            <div class="text-danger small">{{ error }}</div>
          {% endfor %}
        </div>

        <!-- Botones -->
        <div class="col-12 d-flex justify-content-start mt-3">
          <button type="submit" class="btn btn-success me-2">
            <i class="bi bi-save"></i> Registrar Movimiento
          </button>
          <a href="{% url 'caja:movimientos' %}" class="btn btn-outline-secondary">
            <i class="bi bi-x-circle"></i> Cancelar
          </a>
        </div>

      </form>

    </div>
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
    const formaPago = document.getElementById("id_tipo_pago");
    const numeroRefDiv = document.getElementById("div_numero_referencia");
    const numeroRefInput = document.getElementById("id_numero_referencia");

    function toggleReferencia() {
        if (formaPago.value === "tarjeta" || formaPago.value === "transferencia") {
            numeroRefDiv.style.display = "block";
        } else {
            numeroRefDiv.style.display = "none";
            if (numeroRefInput) {
                numeroRefInput.value = "";
            }
        }
    }

    if (formaPago) {
        formaPago.addEventListener("change", toggleReferencia);
        toggleReferencia(); // ejecutar al cargar
    }
});
</script>
{% endblock %}
